---
layout: post
title: "WriteUp - Try Hack Me"
---

# WriteUp: Blue | TryHackMe

## Introducci√≥n

La m√°quina **Blue** de [TryHackMe](https://tryhackme.com/room/blue) es un reto de nivel principiante dise√±ado para introducir al usuario en el uso de herramientas de escaneo y explotaci√≥n b√°sica. El objetivo principal de este laboratorio es explotar una vulnerabilidad cr√≠tica en sistemas Windows: **MS17-010**, com√∫nmente conocida como **EternalBlue**.

Este WriteUp documenta paso a paso el proceso seguido para identificar y explotar la vulnerabilidad, incorporando tambi√©n los fundamentos te√≥ricos necesarios para su comprensi√≥n. Se detallan las herramientas utilizadas, el razonamiento detr√°s de cada acci√≥n y las lecciones aprendidas a lo largo del ejercicio.

## Metodolog√≠a de desarrollo

Antes de comenzar con el reconocimiento activo, es importante adoptar una metodolog√≠a organizada. Documentar cada hallazgo te permitir√° tener un mejor control del an√°lisis y facilitar√° el seguimiento l√≥gico durante todo el laboratorio.

Te recomiendo mantener un archivo de notas (puede ser un bloc de notas, Obsidian, CherryTree, Notion, etc.) donde registres informaci√≥n clave como:

- IP de la m√°quina objetivo
- Puertos abiertos y servicios detectados
- Versiones de software en ejecuci√≥n
- Vulnerabilidades identificadas
- Comandos ejecutados y sus resultados

> üìù Una buena documentaci√≥n no solo mejora tu productividad, tambi√©n te entrena para aplicar buenas pr√°cticas profesionales en entornos reales de pentesting.

## Desarrollo y AN√ÅLISIS del laboratorio

Primero debemos de tener en cuenta frases importante que se nos comparte en la descripci√≥n del laboratorio:

> Escanee y descubra a qu√© exploit es vulnerable esta m√°quina. Tenga en cuenta que esta m√°quina no responde a pings (ICMP) y puede tardar unos minutos en iniciarse.¬†**Esta sala no est√° dise√±ada para ser un CTF de boot2root, sino una serie educativa para principiantes.**
### Explicaci√≥n por partes:

1) **"Escanee y descubra a qu√© exploit es vulnerable esta m√°quina."**

Esto significa que debemos de usar t√©cnicas de **reconocimiento y escaneo de vulnerabilidades** (por ejemplo, con `nmap`) para identificar alguna **vulnerabilidad conocida** en el sistema objetivo. Luego, con base en esa informaci√≥n, buscar un exploit espec√≠fico que la aproveche.

2) **"Tenga en cuenta que esta m√°quina no responde a pings (ICMP)..."**

La m√°quina **no responde a paquetes ping** (ICMP), por lo tanto, comandos como:
 
```bash
ping <IP>
```

...no funcionar√°n.

3) **"Esta sala no est√° dise√±ada para ser un CTF de boot2root..."**

Un **CTF boot2root** es un reto en el que empiezas con acceso nulo y tu objetivo es llegar a ser `root` (administrador) del sistema. Aqu√≠ te dicen que **ese no es el objetivo principal**, sino **entender c√≥mo funciona un exploit espec√≠fico**.

---

### Task 1: Recon

#### 1. Scan the machine. (If you are unsure how to tackle this, I recommend checking out the [Nmap](https://tryhackme.com/room/furthernmap) room)

> **Traducci√≥n de la pregunta:**  
> Escanea la m√°quina. (Si no est√°s seguro de c√≥mo hacerlo, te recomiendo revisar la sala de [Nmap](https://tryhackme.com/room/furthernmap)).

---

##### Objetivo del escaneo

Como primer paso, debemos realizar un escaneo a la m√°quina v√≠ctima para identificar posibles **vulnerabilidades** explotables. De acuerdo con el an√°lisis previo del laboratorio, el prop√≥sito principal es detectar alguna debilidad espec√≠fica del sistema, por lo que el escaneo debe estar enfocado en identificar servicios vulnerables.

---

##### Comando utilizado

```bash
sudo nmap -sV -Pn --script=vuln <IP_de_la_m√°quina_v√≠ctima>
```

##### Desglose de opciones:

- **`-Pn`** ‚Äì _Omitir detecci√≥n de host_  
    Indica a Nmap que **no realice ping** para verificar si el host est√° activo. Esto es √∫til si el firewall de la m√°quina v√≠ctima bloquea respuestas ICMP o si simplemente queremos forzar el escaneo de puertos.
    
- **`-sV`** ‚Äì _Detecci√≥n de versiones de servicios_  
    Permite identificar qu√© servicios est√°n corriendo en los puertos abiertos, as√≠ como sus versiones, lo que es esencial para buscar vulnerabilidades espec√≠ficas asociadas a esos servicios.
    
- **`--script=vuln`** ‚Äì _Ejecuci√≥n de scripts de vulnerabilidades conocidos_  
    Ejecuta una serie de scripts NSE (Nmap Scripting Engine) que intentan detectar **vulnerabilidades conocidas** en los servicios detectados, como versiones sin parches o configuraciones inseguras.

---

##### Resultado esperado

El escaneo debe proporcionarnos una lista de puertos abiertos, servicios en ejecuci√≥n y posibles vulnerabilidades asociadas. Esta informaci√≥n ser√° clave para seleccionar un exploit adecuado en la siguiente etapa del laboratorio.

---

#### 2. How many ports are open with a port number under 1000?

> **Traducci√≥n de la pregunta:**  
> ¬øCu√°ntos puertos est√°n abiertos con un n√∫mero de puerto menor a 1000?

---

##### Objetivo de la pregunta

El prop√≥sito es identificar cu√°ntos puertos abiertos tienen un n√∫mero inferior a **1000**, es decir, dentro del **rango de puertos conocidos o ‚Äúwell-known ports‚Äù** (0‚Äì1023). Estos puertos suelen estar asociados a servicios esenciales del sistema.

---

##### An√°lisis del resultado del escaneo Nmap

Una vez finalizado el escaneo, se presenta la siguiente informaci√≥n:

```bash
PORT      STATE SERVICE        VERSION
135/tcp   open  msrpc          Microsoft Windows RPC
139/tcp   open  netbios-ssn    Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds   Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
3389/tcp  open  ms-wbt-server?
|_ssl-ccs-injection: No reply from server (TIMEOUT)
| rdp-vuln-ms12-020: 
|   VULNERABLE:
|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0152
|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152
|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020
|   
|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0002
|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002
|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020
49152/tcp open  msrpc          Microsoft Windows RPC
49153/tcp open  msrpc          Microsoft Windows RPC
49154/tcp open  msrpc          Microsoft Windows RPC
49158/tcp open  msrpc          Microsoft Windows RPC
49159/tcp open  msrpc          Microsoft Windows RPC
```

---

##### Filtrado de puertos menores a 1000

De los puertos listados, los siguientes cumplen la condici√≥n:

- **135/tcp**
    
- **139/tcp**
    
- **445/tcp**
    

Esto nos da un **total de 3 puertos abiertos** con n√∫mero menor a 1000.

---
#### 3. What is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067)

> **Traducci√≥n de la pregunta:**  
> ¬øA qu√© es vulnerable esta m√°quina? (Respuesta en formato: ms??-???, ej.: ms08-067)

---

##### Objetivo de la pregunta

El prop√≥sito es identificar una **vulnerabilidad espec√≠fica** (normalmente con el formato MSXX-XXX) que afecte a la m√°quina escaneada. Este tipo de vulnerabilidades suelen ser utilizadas en exploits ampliamente conocidos.

---

##### An√°lisis de la salida del escaneo Nmap

En la secci√≥n correspondiente a los scripts NSE aplicados al servicio SMB, se observa el siguiente resultado:

```bash
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
```

Esto indica claramente que el sistema es vulnerable a:

- **MS17-010**, una vulnerabilidad cr√≠tica de **ejecuci√≥n remota de c√≥digo (RCE)** en el protocolo SMBv1 de Windows.


---

##### Contexto adicional

La vulnerabilidad **MS17-010** es famosa por haber sido utilizada por el exploit **EternalBlue**, empleado en ataques como **WannaCry**. Afecta a versiones no parchadas de Windows que usan SMBv1.

**Respuesta final:** ms17-010

---

### Task 2: Gain Access

#### 1. Start¬†[Metasploit](https://tryhackme.com/module/metasploit)
   
> **En espa√±ol**
> Inicia Metasploit

- En este caso, para iniciar Metasploit ejecutamos el siguiente comando: `sudo msfconsole`
- Una vez cargado metasploit, nos aparecer√° lo siguiente:

